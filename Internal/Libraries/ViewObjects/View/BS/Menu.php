<?php namespace ZN\ViewObjects\View\BS;

use Buffer;

class Menu implements MenuInterface
{
    //--------------------------------------------------------------------------------------------------------
    //
    // Author     : Ozan UYKUN <ozanbote@gmail.com>
    // Site       : www.znframework.com
    // License    : The MIT License
    // Copyright  : (c) 2012-2016, znframework.com
    //
    //--------------------------------------------------------------------------------------------------------

    //--------------------------------------------------------------------------------------------------------
    // Tab Count
    //--------------------------------------------------------------------------------------------------------
    //
    // @var int
    //
    //--------------------------------------------------------------------------------------------------------
    protected $tabCount = 0;

    //--------------------------------------------------------------------------------------------------------
    // Tab Count
    //--------------------------------------------------------------------------------------------------------
    //
    // @var int
    //
    //--------------------------------------------------------------------------------------------------------
    protected $useCount = 0;

    //--------------------------------------------------------------------------------------------------------
    // Menu List
    //--------------------------------------------------------------------------------------------------------
    //
    // @var array
    //
    //--------------------------------------------------------------------------------------------------------
    protected $menuList = [];

    //--------------------------------------------------------------------------------------------------------
    // Tab
    //--------------------------------------------------------------------------------------------------------
    //
    // @param string $tabName
    // @param string $content
    //
    //--------------------------------------------------------------------------------------------------------
    public function tab(String $tabName = NULL, String $content = NULL)
    {
        $this->tabCount++;

        $id = 'menu_' . $this->useCount . '_' . $this->tabCount;

        $this->menuList[$id] = $content;

        $active = Properties::$active ?? 1;

        echo HT . '<li'.( $this->tabCount === $active ? ' class="active"' : NULL ).'><a data-toggle="tab" href="#'. $id . '">'.$tabName.'</a></li>' . EOL;
    }

    //--------------------------------------------------------------------------------------------------------
    // Menu
    //--------------------------------------------------------------------------------------------------------
    //
    // @param callable $callback
    //
    //--------------------------------------------------------------------------------------------------------
    public function menu(Callable $callback) : String
    {
        $this->useCount++;

        $active  = Properties::$active ?? 1;

        $return  = '<ul class="nav nav-'.(Properties::$type ?? 'tabs').'">' . EOL;
        $return .= Buffer::callback($callback, [$this]);
        $return .= '</ul>' . EOL;
        $return .= '<div class="tab-content">' . EOL;

        foreach( $this->menuList as $key => $val )
        {
            $return .= HT . '<div id="' . $key . '" class="tab-pane fade'.($key === 'menu_'.$this->useCount.'_' . $active ? ' active in' : NULL).'">';
            $return .= $val;
            $return .= '</div>' . EOL;
        }

        $return .= '</div>' . EOL;

        $this->_default();

        return $return;
    }

    //--------------------------------------------------------------------------------------------------------
    // Protected Default
    //--------------------------------------------------------------------------------------------------------
    //
    // @param void
    //
    //--------------------------------------------------------------------------------------------------------
    protected function _default()
    {
        $this->menuList     = [];
        $this->tabCount     = 0;
        Properties::$type   = NULL;
        Properties::$active = NULL;
    }
}
